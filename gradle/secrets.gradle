import groovy.json.JsonSlurper

def loadSecrets() {
    final def secretFile = file 'secrets.json'
    loadSecrets(secretFile)
}

def loadSecrets(secretFile) {
    if (secretFile.exists()) {
        secretFile.withReader {
            Map secretMap = new JsonSlurper().parse it
            for (entry in secretMap) {
                project.ext.set(entry.key, entry.value)
            }
            project.logger.info('Successfully loaded ' + secretMap.size() + ' secret properties')
        }
    }
    else {
        project.logger.warn('The secret file ' + secretFile.getName() + ' could not be loaded. It does not exist.')
    }
}

ext {
    loadSecrets = this.&loadSecrets
}